<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíï –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíï</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Apple Color Emoji';
            src: local('Apple Color Emoji'), local('AppleColorEmoji'), local('apple-color-emoji');
            src:
                url('assets/fonts/AppleColorEmoji.woff2') format('woff2'),
                url('assets/fonts/AppleColorEmoji.svg') format('svg');
        }

        .emoji {
            font-family: 'Apple Color Emoji';
        }
    </style>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a0a0a 0%, #2d0f0f 25%, #1a0a0a 50%, #2d0f0f 75%, #1a0a0a 100%);
            min-height: 100vh;
            font-family: 'Cormorant Garamond', serif;
            color: #f6cacc;
            overflow-x: hidden;
        }

        /* Floating hearts background */
        .hearts-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            font-size: 20px;
            opacity: 0;
            animation: floatUp linear infinite;
            color: #d02224;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            2% {
                opacity: 0.15;
            }
            90% {
                opacity: 0.15;
            }
            100% {
                transform: translateY(-10vh) rotate(360deg) scale(1.2);
                opacity: 0;
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 1.5s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3.5em;
            background: linear-gradient(135deg, #f6cacc, #e35053, #f6cacc);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 200% center; }
        }

        .header p {
            font-size: 1.3em;
            font-style: italic;
            color: #ec8385;
            letter-spacing: 2px;
        }

        .divider {
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d02224, transparent);
            margin: 20px auto;
        }

        /* Chart cards */
        .chart-card {
            background: linear-gradient(145deg, rgba(44, 15, 15, 0.9), rgba(26, 10, 10, 0.95));
            border: 1px solid rgba(208, 34, 36, 0.3);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 45px;
            box-shadow:
                0 0 30px rgba(208, 34, 36, 0.1),
                0 0 60px rgba(208, 34, 36, 0.05),
                inset 0 1px 0 rgba(246, 202, 204, 0.1);
            animation: fadeInUp 1s ease-out;
            animation-fill-mode: both;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow:
                0 0 40px rgba(208, 34, 36, 0.2),
                0 0 80px rgba(208, 34, 36, 0.1),
                inset 0 1px 0 rgba(246, 202, 204, 0.15);
        }

        .chart-card:nth-child(2) { animation-delay: 0.2s; }
        .chart-card:nth-child(3) { animation-delay: 0.4s; }
        .chart-card:nth-child(4) { animation-delay: 0.6s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-card h2 {
            font-family: 'Pacifico', cursive;
            font-size: 2em;
            color: #e35053;
            text-align: center;
            margin-bottom: 8px;
        }

        .chart-card .subtitle {
            text-align: center;
            font-size: 1em;
            color: #ec8385;
            margin-bottom: 5px;
            font-style: italic;
            letter-spacing: 1px;
        }

        .chart-card .formula {
            text-align: center;
            font-size: 0.85em;
            color: #f1a7a9;
            margin-bottom: 25px;
            font-family: 'Courier New', monospace;
            background: rgba(156, 25, 27, 0.15);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(156, 25, 27, 0.2);
            word-break: break-all;
        }

        .canvas-wrapper {
            position: relative;
            background: rgba(10, 5, 5, 0.5);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(208, 34, 36, 0.15);
        }

        canvas {
            max-width: 100%;
        }

        /* Slider styling */
        .slider-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .slider-container label {
            font-family: 'Pacifico', cursive;
            font-size: 1.4em;
            color: #e35053;
        }

        .slider-container input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 300px;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #9c191b, #d02224, #e35053, #f1a7a9);
            outline: none;
            cursor: pointer;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: radial-gradient(circle, #f6cacc, #d02224);
            border: 2px solid #f6cacc;
            box-shadow: 0 0 10px rgba(208, 34, 36, 0.5);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: radial-gradient(circle, #f6cacc, #d02224);
            border: 2px solid #f6cacc;
            box-shadow: 0 0 10px rgba(208, 34, 36, 0.5);
            cursor: pointer;
        }

        .slider-value {
            font-size: 1.3em;
            color: #f6cacc;
            min-width: 60px;
            text-align: center;
            background: rgba(156, 25, 27, 0.2);
            padding: 4px 12px;
            border-radius: 8px;
            border: 1px solid rgba(208, 34, 36, 0.3);
            font-family: 'Courier New', monospace;
        }

        /* ==========================================
           VALENTINE QUESTION BLOCK
           ========================================== */
        .valentine-card {
            background: linear-gradient(145deg, rgba(44, 15, 15, 0.9), rgba(26, 10, 10, 0.95));
            border: 1px solid rgba(208, 34, 36, 0.3);
            border-radius: 20px;
            padding: 45px 35px;
            margin-bottom: 45px;
            box-shadow:
                0 0 40px rgba(208, 34, 36, 0.15),
                0 0 80px rgba(208, 34, 36, 0.08),
                inset 0 1px 0 rgba(246, 202, 204, 0.1);
            animation: fadeInUp 1s ease-out 0.6s both;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .valentine-card:hover {
            transform: translateY(-5px);
            box-shadow:
                0 0 50px rgba(208, 34, 36, 0.25),
                0 0 100px rgba(208, 34, 36, 0.12),
                inset 0 1px 0 rgba(246, 202, 204, 0.15);
        }

        .valentine-card .question-emoji {
            font-size: 4em;
            display: block;
            margin-bottom: 15px;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .valentine-card h2 {
            font-family: 'Pacifico', cursive;
            font-size: 2.6em;
            background: linear-gradient(135deg, #f6cacc, #e35053, #f6cacc);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
            margin-bottom: 30px;
        }

        .valentine-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .btn-valentine {
            font-family: 'Pacifico', cursive;
            font-size: 1.5em;
            padding: 14px 45px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn-valentine::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn-valentine:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn-yes {
            background: linear-gradient(135deg, #1e6b0a, #2a850e, #34a012);
            color: #ffffff;
            box-shadow:
                0 0 20px rgba(42, 133, 14, 0.3),
                0 4px 15px rgba(42, 133, 14, 0.2);
        }

        .btn-yes:hover {
            transform: scale(1.08);
            box-shadow:
                0 0 30px rgba(42, 133, 14, 0.5),
                0 6px 20px rgba(42, 133, 14, 0.3);
        }

        .btn-no {
            background: linear-gradient(135deg, #7a1518, #9c191b, #ac1c1e);
            color: #f6cacc;
            box-shadow:
                0 0 15px rgba(156, 25, 27, 0.2),
                0 4px 15px rgba(156, 25, 27, 0.15);
        }

        .btn-no:hover {
            transform: scale(1.05);
            box-shadow:
                0 0 25px rgba(156, 25, 27, 0.4),
                0 6px 20px rgba(156, 25, 27, 0.25);
        }

        /* Growing Yes button on each "No" attempt */
        .btn-yes.grow-1 {
            font-size: 1.8em;
            padding: 18px 55px;
        }

        .btn-yes.grow-2 {
            font-size: 2.2em;
            padding: 22px 65px;
        }

        .btn-no.shrink-1 {
            font-size: 1.2em;
            padding: 10px 30px;
        }

        .btn-no.shrink-2 {
            font-size: 0.95em;
            padding: 8px 22px;
        }

        /* Response message */
        .valentine-response {
            display: none;
            margin-top: 25px;
            animation: fadeInUp 0.8s ease-out;
        }

        .valentine-response.show {
            display: block;
        }

        .valentine-response .response-emoji {
            font-size: 5em;
            display: block;
            margin-bottom: 10px;
        }

        .valentine-response p {
            font-family: 'Pacifico', cursive;
            font-size: 2em;
            color: #f6cacc;
        }

        .valentine-response.yes-response p {
            color: #5dd43b;
        }

        .valentine-response.no-response p {
            color: #ec8385;
        }

        /* Confetti burst */
        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 9999;
            animation: confettiFall linear forwards;
        }

        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg) scale(0.3);
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            animation: fadeInUp 1s ease-out 0.8s both;
        }

        .footer .heart-big {
            font-size: 3em;
            animation: heartbeat 1.5s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.1); }
        }

        .footer p {
            font-family: 'Pacifico', cursive;
            font-size: 1.8em;
            color: #e35053;
            margin-top: 10px;
        }

        /* Sparkle effect */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #f6cacc;
            border-radius: 50%;
            pointer-events: none;
            animation: sparkle 1s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        @media (max-width: 600px) {
            .header h1 { font-size: 2.2em; }
            .chart-card { padding: 20px; }
            .chart-card h2 { font-size: 1.5em; }
            .valentine-card h2 { font-size: 1.8em; }
            .slider-container input[type="range"] { width: 200px; }
            .btn-valentine { font-size: 1.2em; padding: 12px 30px; }
            .btn-yes.grow-1 { font-size: 1.4em; padding: 14px 38px; }
            .btn-yes.grow-2 { font-size: 1.7em; padding: 16px 45px; }
        }
    </style>
</head>
<body>

    <!-- Floating hearts background -->
    <div class="hearts-bg" id="heartsBg"></div>

    <div class="container">
        <div class="header">
            <h1><span class="emoji">üíï</span> –ù–∞—Å—Ç–µ–Ω—å–∫–∞ <span class="emoji">üíï</span></h1>
            <div class="divider"></div>
            <p>–ü–æ—Å—Ç–∞—Ä–∞—é—Å—å —Å–∫–∞–∑–∞—Ç—å —Ç–æ, —á—Ç–æ —Å–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞–º–∏...</p>
        </div>

        <!-- Chart 1: Parametric Heart -->
        <div class="chart-card">
            <h2><span class="emoji">üíó</span> –°–µ—Ä–¥—Ü–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º–µ</h2>
            <p class="subtitle">–¢—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–µ–µ, —á–µ–º —Å–∏–º–º–µ—Ç—Ä–∏—è</p>
            <div class="formula">
                x(t) = 16¬∑sin¬≥(t) &nbsp;|&nbsp; y(t) = 13¬∑cos(t) ‚àí 5¬∑cos(2t) ‚àí 2¬∑cos(3t) ‚àí cos(4t) &nbsp;|&nbsp; t ‚àà [0, 2œÄ]
            </div>
            <div class="canvas-wrapper">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        <!-- Chart 2: Implicit Heart with slider -->
        <div class="chart-card">
            <h2><span class="emoji">üíó</span> –°–µ—Ä–¥–µ—á–Ω–∞—è –≤–æ–ª–Ω–∞</h2>
            <p class="subtitle">–ò–≥—Ä–∞–π —Å–æ —Å–ª–∞–π–¥–µ—Ä–æ–º - —Å–º–æ—Ç—Ä–∏, –∫–∞–∫ –±—å—ë—Ç—Å—è —Å–µ—Ä–¥—Ü–µ</p>
            <div class="formula">
                f(x) = x^(2/3) + 0.9¬∑(3.3 ‚àí x¬≤)^(1/2)¬∑sin(a¬∑œÄ¬∑x) &nbsp;|&nbsp; a ‚àà [‚àí10, 10]
            </div>
            <div class="slider-container">
                <label for="sliderA">a =</label>
                <input type="range" id="sliderA" min="-10" max="10" step="0.1" value="5">
                <span class="slider-value" id="sliderValue">5.0</span>
            </div>
            <div class="canvas-wrapper">
                <canvas id="chart2"></canvas>
            </div>
        </div>

        <!-- Valentine Question -->
        <div class="valentine-card" id="valentineCard">
            <span class="question-emoji emoji">üíù</span>
            <h2>Will you be my Valentine?</h2>
            <div class="valentine-buttons" id="valentineButtons">
                <button class="btn-valentine btn-yes" id="btnYes" onclick="handleYes()">
                    <span class="emoji">üíö</span> –î–∞!
                </button>
                <button class="btn-valentine btn-no" id="btnNo" onclick="handleNo()">
                    –ù–µ—Ç
                </button>
            </div>
            <div class="valentine-response" id="valentineResponse">
                <span class="response-emoji emoji" id="responseEmoji"></span>
                <p id="responseText"></p>
            </div>
        </div>

        <div class="footer">
            <div class="heart-big emoji">üíï</div>
            <p>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —á—É–≤—Å—Ç–≤–∞ –ø—Ä–æ—â–µ –≤—ã—Ä–∞–∑–∏—Ç—å —Ñ–æ—Ä–º—É–ª–∞–º–∏...</p>
        </div>
    </div>

    <script>
        // ==========================================
        //  COLOR PALETTE
        // ==========================================
        const palette = [
            "#9c191b", "#ac1c1e", "#bd1f21", "#d02224", "#dd2c2f",
            "#e35053", "#e66063", "#ec8385", "#f1a7a9", "#f6cacc"
        ];

        // ==========================================
        //  FLOATING HEARTS BACKGROUND (FIXED)
        // ==========================================
        function createFloatingHearts() {
            const container = document.getElementById('heartsBg');
            const hearts = ['‚ù§Ô∏è', 'üíñ', 'üíù', 'üß∏', 'üíé', 'üíå'];

            for (let i = 0; i < 25; i++) {
                const heart = document.createElement('span');
                heart.className = 'floating-heart emoji';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.fontSize = (12 + Math.random() * 24) + 'px';

                const duration = 8 + Math.random() * 15;
                heart.style.animationDuration = duration + 's';

                // Stagger start: each heart begins at a random point in the cycle
                // Negative delay makes animation start mid-cycle, avoiding initial stuck state
                heart.style.animationDelay = -(Math.random() * duration) + 's';

                heart.style.color = palette[Math.floor(Math.random() * palette.length)];
                container.appendChild(heart);
            }
        }
        createFloatingHearts();

        // ==========================================
        //  CHART.JS DEFAULTS
        // ==========================================
        Chart.defaults.color = '#f1a7a9';
        Chart.defaults.borderColor = 'rgba(156, 25, 27, 0.2)';

        const gridColor = 'rgba(156, 25, 27, 0.15)';
        const tickColor = '#ec8385';

        // ==========================================
        //  CHART 1: PARAMETRIC HEART
        // ==========================================
        function generateParametricHeart() {
            const points = [];
            const numPoints = 500;
            for (let i = 0; i <= numPoints; i++) {
                const t = (2 * Math.PI * i) / numPoints;
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t)
                          - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                points.push({ x: x, y: y });
            }
            return points;
        }

        function createGradientLine(ctx, chartArea) {
            if (!chartArea) return palette[4];
            const gradient = ctx.createLinearGradient(
                chartArea.left, chartArea.bottom,
                chartArea.left, chartArea.top
            );
            gradient.addColorStop(0, palette[0]);
            gradient.addColorStop(0.3, palette[3]);
            gradient.addColorStop(0.5, palette[5]);
            gradient.addColorStop(0.7, palette[7]);
            gradient.addColorStop(1, palette[9]);
            return gradient;
        }

        const ctx1 = document.getElementById('chart1').getContext('2d');
        const heartData = generateParametricHeart();

        const chart1 = new Chart(ctx1, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: '–°–µ—Ä–¥—Ü–µ',
                    data: heartData,
                    showLine: true,
                    borderWidth: 3,
                    borderColor: function(context) {
                        const chart = context.chart;
                        const { ctx, chartArea } = chart;
                        return createGradientLine(ctx, chartArea);
                    },
                    pointRadius: 0,
                    fill: true,
                    backgroundColor: 'rgba(208, 34, 36, 0.08)',
                    tension: 0,
                }]
            },
            options: {
                responsive: true,
                aspectRatio: 1,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                },
                scales: {
                    x: {
                        min: -20,
                        max: 20,
                        grid: { color: gridColor },
                        ticks: { color: tickColor, font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'x',
                            color: '#e35053',
                            font: { size: 14, family: 'Pacifico' }
                        }
                    },
                    y: {
                        min: -20,
                        max: 18,
                        grid: { color: gridColor },
                        ticks: { color: tickColor, font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'y',
                            color: '#e35053',
                            font: { size: 14, family: 'Pacifico' }
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeInOutQuart'
                }
            }
        });

        // ==========================================
        //  CHART 2: f(x) with slider
        // ==========================================
        function generateFxData(a) {
            const points = [];
            const numPoints = 1000;
            const xMin = -Math.sqrt(3.3);
            const xMax = Math.sqrt(3.3);

            for (let i = 0; i <= numPoints; i++) {
                const x = xMin + (xMax - xMin) * i / numPoints;
                const inner = 3.3 - x * x;
                if (inner < 0) continue;

                const term1 = Math.pow(Math.abs(x), 2 / 3);
                const term2 = 0.9 * Math.sqrt(inner) * Math.sin(a * Math.PI * x);
                const y = term1 + term2;

                if (isFinite(y)) {
                    points.push({ x: parseFloat(x.toFixed(4)), y: parseFloat(y.toFixed(4)) });
                }
            }
            return points;
        }

        const ctx2 = document.getElementById('chart2').getContext('2d');
        let currentA = 5;

        const chart2 = new Chart(ctx2, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'f(x)',
                    data: generateFxData(currentA),
                    showLine: true,
                    borderWidth: 3,
                    borderColor: palette[7], // color matching a=5 position
                    pointRadius: 0,
                    fill: true,
                    backgroundColor: 'rgba(208, 34, 36, 0.06)',
                    tension: 0.1,
                }]
            },
            options: {
                responsive: true,
                aspectRatio: 1,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 10, 10, 0.9)',
                        borderColor: palette[4],
                        borderWidth: 1,
                        titleColor: palette[9],
                        bodyColor: palette[8],
                        callbacks: {
                            label: function(context) {
                                return `x: ${context.parsed.x.toFixed(2)}, f(x): ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        min: -2.5,
                        max: 2.5,
                        grid: { color: gridColor },
                        ticks: { color: tickColor, font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'x',
                            color: '#e35053',
                            font: { size: 14, family: 'Pacifico' }
                        }
                    },
                    y: {
                        min: -2,
                        max: 3,
                        grid: { color: gridColor },
                        ticks: { color: tickColor, font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'f(x)',
                            color: '#e35053',
                            font: { size: 14, family: 'Pacifico' }
                        }
                    }
                },
                animation: {
                    duration: 300,
                    easing: 'easeOutQuad'
                }
            }
        });

        // Slider interaction
        const slider = document.getElementById('sliderA');
        const sliderValueDisplay = document.getElementById('sliderValue');

        slider.addEventListener('input', function() {
            currentA = parseFloat(this.value);
            sliderValueDisplay.textContent = currentA.toFixed(1);

            const normalizedA = (currentA + 10) / 20;
            const colorIndex = Math.floor(normalizedA * (palette.length - 1));
            const lineColor = palette[Math.min(colorIndex, palette.length - 1)];

            chart2.data.datasets[0].data = generateFxData(currentA);
            chart2.data.datasets[0].borderColor = lineColor;
            chart2.update('none');
        });

        // ==========================================
        //  VALENTINE QUESTION LOGIC
        // ==========================================
        let noCount = 0;
        const maxNoAttempts = 2;

        const noButtonTexts = [
            '–¢—ã —É–≤–µ—Ä–µ–Ω–∞? <span class="emoji">ü•∫</span>',
            '–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å... <span class="emoji">üíî</span>'
        ];

        const yesButtonTexts = [
            '<span class="emoji">üíö</span> –î–∞!',
            '<span class="emoji">üíö</span> –ù—É –∫–æ–Ω–µ—á–Ω–æ –î–∞!',
            '<span class="emoji">üíö</span> –î–ê–ê–ê! <span class="emoji">üíï</span>'
        ];

        function handleYes() {
            const btnYes = document.getElementById('btnYes');
            const btnNo = document.getElementById('btnNo');
            const response = document.getElementById('valentineResponse');
            const responseEmoji = document.getElementById('responseEmoji');
            const responseText = document.getElementById('responseText');

            // Send GET request
            // fetch('https://twilight-band-55ab.m-melgizin.workers.dev/yes').catch(() => {});

            // Hide buttons
            document.getElementById('valentineButtons').style.display = 'none';

            // Show response
            response.className = 'valentine-response show yes-response';
            responseEmoji.textContent = 'ü•∞üíïüéâ';
            responseText.textContent = '–¢—ã —Å–¥–µ–ª–∞–ª–∞ –º–µ–Ω—è —Å–∞–º—ã–º —Å—á–∞—Å—Ç–ª–∏–≤—ã–º!';

            // Launch confetti
            launchConfetti();
        }

        function handleNo() {
            noCount++;
            const btnYes = document.getElementById('btnYes');
            const btnNo = document.getElementById('btnNo');

            if (noCount <= maxNoAttempts) {
                // fetch('https://twilight-band-55ab.m-melgizin.workers.dev/no').catch(() => {});

                // Change button texts
                btnNo.innerHTML = noButtonTexts[noCount - 1];
                btnYes.innerHTML = yesButtonTexts[noCount];

                // Grow Yes, shrink No
                btnYes.className = `btn-valentine btn-yes grow-${noCount}`;
                btnNo.className = `btn-valentine btn-no shrink-${noCount}`;

                // Shake the card
                const card = document.getElementById('valentineCard');
                card.style.animation = 'none';
                card.offsetHeight; // trigger reflow
                card.style.animation = 'shake 0.5s ease-in-out';
            } else {
                // Final "No" ‚Äî send request and show sad response
                // fetch('https://twilight-band-55ab.m-melgizin.workers.dev/no_final').catch(() => {});

                document.getElementById('valentineButtons').style.display = 'none';

                const response = document.getElementById('valentineResponse');
                const responseEmoji = document.getElementById('responseEmoji');
                const responseText = document.getElementById('responseText');

                response.className = 'valentine-response show no-response';
                responseEmoji.textContent = 'üíîüò¢';
                responseText.textContent = '–ú–æ–∂–µ—Ç, –æ–¥–Ω–∞–∂–¥—ã...';
            }
        }

        // Shake animation (injected dynamically)
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                15% { transform: translateX(-8px) rotate(-1deg); }
                30% { transform: translateX(8px) rotate(1deg); }
                45% { transform: translateX(-6px) rotate(-0.5deg); }
                60% { transform: translateX(6px) rotate(0.5deg); }
                75% { transform: translateX(-3px); }
            }
        `;
        document.head.appendChild(shakeStyle);

        // ==========================================
        //  CONFETTI BURST
        // ==========================================
        function launchConfetti() {
            const colors = [...palette, '#2a850e', '#34a012', '#5dd43b', '#FFD700', '#FF69B4'];
            const shapes = ['circle', 'square'];

            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';

                const size = 6 + Math.random() * 10;
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = (20 + Math.random() * 60) + 'vw';
                confetti.style.top = (-10 + Math.random() * 20) + 'vh';
                confetti.style.animationDuration = (2 + Math.random() * 3) + 's';
                confetti.style.animationDelay = (Math.random() * 0.8) + 's';

                if (shapes[Math.floor(Math.random() * 2)] === 'circle') {
                    confetti.style.borderRadius = '50%';
                } else {
                    confetti.style.borderRadius = '2px';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                }

                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5500);
            }
        }

        // ==========================================
        //  SPARKLE EFFECT ON CLICK
        // ==========================================
        document.addEventListener('click', function(e) {
            for (let i = 0; i < 6; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = (e.clientX + (Math.random() - 0.5) * 40) + 'px';
                sparkle.style.top = (e.clientY + (Math.random() - 0.5) * 40) + 'px';
                sparkle.style.width = (3 + Math.random() * 5) + 'px';
                sparkle.style.height = sparkle.style.width;
                sparkle.style.background = palette[Math.floor(Math.random() * palette.length)];
                sparkle.style.position = 'fixed';
                sparkle.style.zIndex = '9999';
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1000);
            }
        });
    </script>
</body>
</html>